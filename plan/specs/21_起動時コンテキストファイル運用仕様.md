# 起動時コンテキストファイル運用仕様書 v0.2-draft

## 1. 目的

個人 x 複数AIエージェント運用で、前提説明の重複と指示ドリフトを防ぐため、起動時に参照する指示ファイルの種類・目的・管理ルールを標準化する。

## 2. 前提

- 共通ルールは短く、局所ルールは近い階層へ置く。
- 常時適用（always-on）と呼び出し型（on-demand）を分離する。
- セキュリティ優先順位 `A > B > C` を維持する。
- 企画フェーズではファイル設計と運用手順の確定までを対象とし、実行環境への適用は次フェーズで行う。

## 3. ファイル分類

| 区分 | ファイル例 | 目的 | 適用粒度 |
| --- | --- | --- | --- |
| 共通ルール（クロスツール） | `AGENTS.md` | プロジェクト共通の作法、禁止事項、標準コマンド | リポジトリ/ディレクトリ |
| 局所上書き（Codex向け） | `AGENTS.override.md` | サブ領域での一時/局所上書き | サブディレクトリ |
| Copilot全体指示 | `.github/copilot-instructions.md` | Copilot利用時の全体ルール | リポジトリ |
| Copilot条件付き指示 | `.github/instructions/*.instructions.md` | `applyTo` で言語/パス別ルール | ファイルパターン |
| 役割別プロファイル | `.github/agents/*.agent.md` | Planner/Tester/Reviewer等の役割固定 | エージェント単位 |
| 呼び出し型プロンプト | `.github/prompts/*.prompt.md` | 計画作成/レビュー等の定型手順 | 手動呼び出し |
| 互換ファイル | `CLAUDE.md`, `GEMINI.md` | 他ツール互換の入口 | 任意 |

## 4. 配置と優先ルール

- 原則:
  - ルート `AGENTS.md` は最重要ルールのみ記載
  - サブディレクトリは必要最小限の差分のみ記載
- 優先:
  - 近い階層のルールを優先
  - `AGENTS.override.md` がある場合は同階層 `AGENTS.md` より優先
- 運用:
  - ルール変更時は新規セッションで反映確認する
  - 1ファイル肥大化を避け、用途別に分割する

## 5. 記載内容のベストプラクティス

### 5.1 書くべき内容

- テスト入口（例: `make test`, `pnpm test`）
- 変更可能範囲と禁止範囲
- 破壊的操作の禁止
- PR提出時の必須情報

### 5.2 書かない内容

- 秘密情報（token/鍵/機密URL）
- 長大な設計本文の全文
- 検証不能な抽象方針のみ

## 6. 個人運用での推奨構成

```
repo/
  AGENTS.md
  plan/specs/21_起動時コンテキストファイル運用仕様.md
  .github/
    copilot-instructions.md
    instructions/
      backend.instructions.md
      frontend.instructions.md
    agents/
      planner.agent.md
      tester.agent.md
      reviewer.agent.md
    prompts/
      plan.prompt.md
      review.prompt.md
```

## 7. 変更管理

- 重要な追加/削除は `plan/意思決定ログ.md` にADR記録する。
- 影響タスクは `plan/バックログ.md` に追加する。
- 新規リスクは `plan/リスク登録簿.md` に追加する。

## 8. 未決事項

- なし（v0.2運用スコープとして確定）。
