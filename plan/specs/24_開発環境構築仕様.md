# 開発環境構築仕様書 v0.2-draft

## 1. 目的

アプリ本体実装とは分離して、開発環境の初期化と事前チェックを再現可能にする。

## 2. 前提

- 企画フェーズ中はアプリ実装コードを作成しない。
- 開発環境構築スクリプトは「実装準備」の範囲として管理する。
- 認証主体は GitHub App（bot）を標準とし、資格情報はローカル環境変数で注入する。

## 3. スコープ

- 初期化スクリプト（ディレクトリ作成、`.env` 雛形作成）
- 必須コマンドチェック
- GitHub App必須環境変数チェック
- セットアップ実行導線（Makefile / README）

## 4. 要件

### FR-2401 初期化

- `scripts/dev_env_setup.sh --init-only` 実行時に以下を実施する。
  - `var/log/audit` と `var/state` の作成
  - `.env.github-app` 未存在時に `.env.github-app.example` から生成

### FR-2402 環境チェック

- `scripts/dev_env_check.sh` 実行時に以下を検査する。
  - 必須コマンド: `git`, `gh`, `jq`, `curl`, `make`
  - 任意コマンド: `docker`
  - 必須環境変数: `GITHUB_APP_ID`, `GITHUB_APP_INSTALLATION_ID`, `GITHUB_APP_SLUG`, `GITHUB_APP_PRIVATE_KEY_PATH`
  - 秘密鍵ファイルの存在

### FR-2403 終了コード

- チェック結果:
  - 重大不足なし: `exit 0`
  - 不足あり: `exit 1`
  - 引数誤り: `exit 2`

### FR-2404 実行導線

- `Makefile` に以下ターゲットを定義する。
  - `dev-env-init`
  - `dev-env-check`
  - `dev-env-setup`
- `README.md` と `scripts/README.md` に実行手順を記載する。

## 5. セキュリティ要件

- 秘密鍵本体をリポジトリへ保存しない（`keys/` は ignore）。
- `.env.github-app` は ignore し、サンプルのみ追跡する。
- ローカル生成物（`var/`、`.DS_Store`）は追跡しない。

## 6. 受け入れ条件

- 新規開発者が `make dev-env-init` と `make dev-env-check` で不足項目を識別できる。
- 未設定環境変数がある場合に `dev_env_check.sh` が失敗として返る。
- 手順書と実装スクリプトの内容が一致する。

## 7. 未決事項

- 各OS向け依存導入（Homebrew/apt/choco）をスクリプト内で自動化するか
