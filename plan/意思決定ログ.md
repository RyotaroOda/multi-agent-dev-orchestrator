# 意思決定ログ（ADR簡易版）

## ADR-001: 企画フェーズでは実装を開始しない

- 日付: 2026-02-10
- 状態: accepted
- 文脈: 企画段階で仕様ブレを抑えたい
- 決定: 企画完了条件を満たすまで、実装コード作成を行わない
- 影響: ドキュメント作業が先行し、初速は遅くなるが再作業を減らせる
- 次回見直し: M4（開発着手判定）時

## ADR-002: v0.2の成果物受け渡しは方式A（コンテナ非push）を採用する

- 日付: 2026-02-10
- 状態: accepted
- 文脈: セキュリティ優先順位A（漏えい防止）を最優先し、コンテナ側にGitHub書き込み権限を持たせない運用が必要
- 決定: コンテナは `git diff`/パッチとテスト結果のみを出力し、ホスト側でコミット・PR作成を行う
- 代替案: コンテナから直接push/PR作成を行う方式
- 影響: トークン露出リスクを低減できる一方、ホスト側に成果物完全性検証の設計タスクが発生する
- 次回見直し: M2（実行アーキテクチャ方針の確定）時

## ADR-003: policy例外ラベルは期限付き・4項目必須で運用する

- 日付: 2026-02-10
- 状態: accepted
- 文脈: `policy:cloud-llm=allow` などの例外を無制限に使うと、A（漏えい防止）を実運用で崩す恐れがある
- 決定: 例外ラベルは「理由・適用範囲・失効日・承認者」の4点が揃った場合のみ有効とし、欠ける場合は deny 扱いにする
- 代替案: ラベル付与のみで例外を許可する簡易運用
- 影響: 運用の手間は増えるが、例外の監査可能性と濫用抑止が向上する
- 次回見直し: M3（運用・安全ガードレール確定）時

## ADR-004: 動的並列制御は段階制御（0/1/2）で開始する

- 日付: 2026-02-10
- 状態: accepted
- 文脈: 「固定並列数を避ける」方針はあるが、閾値と復帰条件が未定義のため運用で不安定化する
- 決定: v0.2は同時Run上限を段階制御（停止=0/抑制=1/通常=2）で開始し、閾値は計測結果で確定する
- 代替案: 並列数を固定値で運用し続ける
- 影響: 初期運用の安全性は高まるが、閾値調整と監視指標定義の追加検討が必須になる
- 次回見直し: M3（運用・安全ガードレール確定）時

## ADR-005: v0.2の想定実行環境はApple Mac Studio M3 Ultra（メモリ512GB）とする

- 日付: 2026-02-10
- 状態: accepted
- 文脈: リソース制限値、動的並列制御、運用指標の初期チューニング基準を固定する必要がある
- 決定: v0.2の標準実行環境を Apple Mac Studio（M3 Ultra / 512GB）に統一する
- 代替案: ハードウェアを固定せず、環境差を吸収する抽象方針のみで運用する
- 影響: 初期設計と運用基準が明確になる一方、他環境へ展開時は再チューニングが必要
- 次回見直し: M2（実行アーキテクチャ方針の確定）時

## ADR-006: NVIDIA DGX Sparkを将来対応環境として追加し、優先度P2で扱う

- 日付: 2026-02-10
- 状態: accepted
- 文脈: 将来の計算資源拡張を見据えつつ、v0.2の収束を遅らせない優先順位管理が必要
- 決定: NVIDIA DGX Sparkは「将来対応環境」として登録し、企画/検証タスクの優先度をP2（低）とする
- 代替案: v0.2必須スコープに含めて同時対応する
- 影響: 現行v0.2の意思決定速度を維持できる一方、DGX向け最適化は後続フェーズで別途計画が必要
- 次回見直し: M4（開発着手判定）時

## ADR-007: M3 Ultra環境向けのリソース見直しトリガを暫定定義する

- 日付: 2026-02-10
- 状態: superseded
- 文脈: 動的並列制御の閾値が未確定のままでは、運用で調整判断が属人化する
- 決定: `resource_exceeded` blocked率、平均run時間悪化率、メモリプレッシャ警告回数を見直しトリガとして暫定採用する
- 代替案: KPI目標値確定（PLN-009）まで見直しトリガを定義しない
- 影響: 調整判断の再現性は上がるが、閾値自体はKPI確定後に再調整が必要
- 次回見直し: ADR-008 / ADR-009 で置換済み

## ADR-008: v0.2のLevel遷移閾値とヒステリシスを確定する

- 日付: 2026-02-10
- 状態: accepted
- 文脈: 段階制御（0/1/2）の実運用で、降格/復帰条件が曖昧だと挙動が不安定になる
- 決定: queue depth と memory pressure を使った Level遷移閾値、および `0->1`/`1->2` の復帰条件（15分/30分）を採用する
- 代替案: 閾値を固定せず、運用者の手動判断で都度調整する
- 影響: 自動制御の再現性が向上する一方、環境変更時には閾値再評価が必要
- 次回見直し: M3（運用・安全ガードレール確定）時

## ADR-009: v0.2のKPI目標値とアラート閾値を確定する

- 日付: 2026-02-10
- 状態: accepted
- 文脈: KPIの目標値が未定義だと、改善判断とGo/No-Go判定の基準が揃わない
- 決定: throughput / PR作成率 / マージ率 / blocked率 / run時間 / retry分布の目標値、および主要アラート閾値を採用する
- 代替案: 目標値を置かず、観測のみ先行する
- 影響: 企画フェーズでの判定基準が明確になる一方、実運用データに応じた微調整が前提となる
- 次回見直し: M4（開発着手判定）時

## ADR-010: DGX Spark対応方針をP2の統合ドキュメントで管理する

- 日付: 2026-02-10
- 状態: accepted
- 文脈: DGX対応を複数タスクで個別管理すると、差分要件と移行条件が分散して追跡しにくい
- 決定: DGX対応は `09_DGX Spark対応方針.md` に統合し、P2タスク（PLN-011〜015）を集約管理する
- 代替案: 各タスクごとに独立ドキュメントを作る
- 影響: 参照性が向上する一方、更新時に単一ドキュメントの整合管理が必要
- 次回見直し: M4（開発着手判定）時

## ADR-011: v0.2の品質ゲート必須チェックと差分検知閾値を確定する

- 日付: 2026-02-10
- 状態: accepted
- 文脈: 必須チェック名と差分検知閾値が曖昧だと、`blocked` 判定が運用者依存になる
- 決定: `required:test` / `required:lint` / `required:typecheck` / `required:policy-diff` を必須チェックとし、`only/skip` とアサーション減少閾値を固定する
- 代替案: チェック名や閾値をプロジェクトごとに都度定義する
- 影響: 判定の再現性が上がる一方、将来のCI構成変更時に名称追従が必要
- 次回見直し: M3（運用・安全ガードレール確定）時

## ADR-012: v0.2のBlocked復帰手順とretry権限を確定する

- 日付: 2026-02-10
- 状態: accepted
- 文脈: `blocked` 復帰時の操作権限が未定義だと、再試行乱発または停滞の温床になる
- 決定: retryは `write` 以上と runner サービスアカウントのみ許可し、復帰は `blocked_reason` 記録 -> 人間判断 -> `agent:retry`/`/retry` -> 新 `run_id` の手順で運用する
- 代替案: 権限制御を設けず、全コメント発火を受理する
- 影響: 不要な再試行を抑制できる一方、権限不足ユーザーへの案内コメント運用が必要
- 次回見直し: M3（運用・安全ガードレール確定）時

## ADR-013: v0.2のMVP非目的を5項目で固定する

- 日付: 2026-02-10
- 状態: accepted
- 文脈: MVP境界が曖昧だと、企画フェーズで論点が拡散し着手判定が遅延する
- 決定: 1 Issue内分散並列、競合自動解消高度化、見た目重視UI、マルチホスト最適化、本番データ自動検証をv0.2非目的として固定する
- 代替案: 非目的を抽象表現に留め、都度判断する
- 影響: スコープ逸脱を抑止できる一方、非目的領域の要望は後続フェーズ送りとなる
- 次回見直し: M4（開発着手判定）時

## ADR-014: セキュリティ境界と例外ラベル運用規程を分離ドキュメントで管理する

- 日付: 2026-02-10
- 状態: accepted
- 文脈: 禁止事項と例外条件を単一仕様内に混在させると、監査時の参照性が低下する
- 決定: 境界定義は `10_セキュリティ境界マトリクス.md`、例外運用は `11_policy例外ラベル運用規程.md` に分離して管理する
- 代替案: 既存仕様へ追記のみで対応する
- 影響: 監査と運用手順の参照性が向上する一方、2文書の整合管理が必要
- 次回見直し: M3（運用・安全ガードレール確定）時

## ADR-015: 成果物完全性検証はSHA-256をv0.2必須とし、署名検証はv0.3以降とする

- 日付: 2026-02-10
- 状態: accepted
- 文脈: 完全性検証を未確定のままにすると、取り込み時の改ざん検知が運用依存になる
- 決定: v0.2ではSHA-256ハッシュ検証を必須化し、retry時は旧PR close + 新PR相互参照を固定する
- 代替案: 署名検証までv0.2必須にする
- 影響: v0.2で実装可能性を維持しつつ改ざんリスクを下げられるが、署名による真正性担保は後続課題として残る
- 次回見直し: M4（開発着手判定）時

## ADR-016: M4 Go/No-Goチェックリストを判定日付きで運用する

- 日付: 2026-02-10
- 状態: superseded
- 文脈: 開発着手判定の恣意性を防ぐため、必須項目と判定責任を固定化する必要がある
- 決定: 判定日を2026-02-21とし、PM/技術責任者/セキュリティ責任者/基盤担当の4者でGo判定を行うチェックリスト運用を採用する
- 代替案: 判定日・判定者を都度設定する
- 影響: 判定プロセスの透明性は上がるが、判定日までの準備タスク管理が必須となる
- 次回見直し: ADR-031で置換済み

## ADR-017: Issue起票はv0.2テンプレートを必須とする

- 日付: 2026-02-10
- 状態: accepted
- 文脈: Issue品質のばらつきが残ると、SoTの機械処理性が低下する
- 決定: 新規Issueは `templates/Issueテンプレート_v0.2.md` を必須テンプレートとして起票する
- 代替案: 推奨テンプレートとして任意利用に留める
- 影響: 起票時の工数は増えるが、Spec Block品質と実行安定性が向上する
- 次回見直し: M4（開発着手判定）時

## ADR-018: fallbackは同一ラベル系列内で1回のみ許可する

- 日付: 2026-02-10
- 状態: accepted
- 文脈: fallback条件が未定義だと、品質劣化モデルへの無制限退避が起こり得る
- 決定: fallbackは同一ラベル系列内で1回のみ許可し、`fallback_used=true` を必須記録とする
- 代替案: 系列制約なしで複数回fallbackを許容する
- 影響: 予期しない品質劣化を抑止できる一方、厳格化によりblocked件数が増える可能性がある
- 次回見直し: M3（運用・安全ガードレール確定）時

## ADR-019: KPI集計と高詳細ログの保存先・保持期間を確定する

- 日付: 2026-02-10
- 状態: accepted
- 文脈: 保存先と保持期間が不定だと、監査証跡の欠落や過保持リスクが発生する
- 決定: SoTログはIssueコメント保持、KPI集計は運用ストア365日、高詳細ログは14日（監査時のみ最長90日延長）とする
- 代替案: すべてIssueのみ保存、または保持期間を固定しない
- 影響: 監査性と保護のバランスが取れる一方、運用ストア管理が追加で必要
- 次回見直し: M4（開発着手判定）時

## ADR-020: DGX移行のGPU制限値と承認体制を確定する

- 日付: 2026-02-10
- 状態: accepted
- 文脈: DGX移行の制限値と承認者が未確定だと、Go/No-Go判定を実運用で実行できない
- 決定: DGXプロファイルの上限を `1 GPU/Run`、`GPUメモリ70%/Run`、`同時GPU Run 2`、`ホスト全体GPUメモリ85%` とし、最終承認者はPM（技術責任者・セキュリティ責任者の共同承認必須）とする
- 代替案: DGX実機検証完了まで数値・承認体制を未定義のまま維持する
- 影響: 移行判定の実行可能性は向上する一方、実機での再チューニング余地を運用で管理する必要がある
- 次回見直し: M4（開発着手判定）時

## ADR-021: 隔離実行基盤の未決事項をv0.2で確定する

- 日付: 2026-02-10
- 状態: accepted
- 文脈: ベースイメージ方針・見直し周期・ネットワーク制御レイヤーが未決のままでは運用基準が揃わない
- 決定: 共通単一ベースイメージ、制限値の週次見直し（閾値超過時は臨時見直し）、Docker一次制御＋ホストFW二次制御を採用する
- 代替案: 言語別イメージ分割と運用者裁量による見直し
- 影響: 運用の再現性は向上する一方、言語別最適化はv0.3以降の課題となる
- 次回見直し: M4（開発着手判定）時

## ADR-022: タスク分解はルールベース固定とし、共有コンテキストを最小化する

- 日付: 2026-02-10
- 状態: accepted
- 文脈: DAG生成方式と共有コンテキストが曖昧だと、タスク実行の決定性と安全性が低下する
- 決定: v0.2はルールベース固定DAG、ドキュメント中心タスクの完了基準固定、共有コンテキスト最小セットを採用する
- 代替案: 学習型DAG生成と広いコンテキスト共有
- 影響: 再現性と安全性は向上する一方、最適化余地は後続フェーズに残る
- 次回見直し: M4（開発着手判定）時

## ADR-023: M4は事前評価Go候補を維持し、本判定準備タスクを追加する

- 日付: 2026-02-10
- 状態: accepted
- 文脈: M4チェックリストの事前評価で G-001〜G-010 が `Yes` となったが、本判定日（2026-02-21）までの準備責任を明確化する必要がある
- 決定: M4状態は `doing` を維持し、`PLN-019`（本判定会準備）/`PLN-020`（根拠凍結運用）/`PLN-021`（Go時着手条件確定）を `ready` として追加する
- 代替案: 事前評価結果のみで即時Goに変更する
- 影響: 判定プロセスの監査性と再現性が向上する一方、2026-02-21までの運用タスク管理が必要になる
- 次回見直し: M4本判定（2026-02-21）

## ADR-024: M4本判定の凍結運用とGo後DoRを確定する

- 日付: 2026-02-10
- 状態: superseded
- 文脈: 本判定直前の根拠差し替えと、Go後の着手条件未定義が判定品質と着手速度の低下要因となる
- 決定: 本判定時刻を `2026-02-21 15:00（ローカル時刻）`、根拠ドキュメント凍結停止時刻を `2026-02-20 18:00（ローカル時刻）` とし、凍結期間中の例外更新はP0かつ技術責任者・セキュリティ責任者の共同承認必須とする。あわせて初回着手Issueの選定基準とDoRを `12_M4本判定と開発着手条件仕様.md` で固定する
- 代替案: 本判定当日まで通常更新を許可し、DoRは各担当の裁量で判断する
- 影響: 判定の再現性と監査性は向上する一方、凍結運用の遵守管理と例外記録運用が追加で必要になる
- 次回見直し: ADR-031で置換済み

## ADR-025: M4本判定会は専用記録テンプレートで運用する

- 日付: 2026-02-10
- 状態: accepted
- 文脈: 判定結果、参加状況、DoR確認が複数文書へ分散すると、監査時の追跡と再現が難しくなる
- 決定: M4本判定会の実施記録は `templates/M4本判定会_記録テンプレート.md` を使用し、判定結果を単一フォーマットで残す
- 代替案: M4チェックリスト本文への追記のみで運用する
- 影響: 記録品質と監査性は向上する一方、判定会当日の記録作業が追加される
- 次回見直し: M4本判定（2026-02-21）

## ADR-026: M4判定者参加確認は段階通知SLAで運用する

- 日付: 2026-02-10
- 状態: superseded
- 文脈: 判定者の参加可否確定が遅れると、M4本判定が直前に不安定化する
- 決定: 参加確認を一次確認（2026-02-17）/再確認（2026-02-18）/最終確認（2026-02-19）で段階運用し、文面は `templates/M4判定者参加確認テンプレート.md` を使用する
- 代替案: 単発連絡のみで参加確認を行う
- 影響: 判定延期リスクを早期検知できる一方、PMの連絡運用工数が増える
- 次回見直し: ADR-031で置換済み

## ADR-027: M4判定者参加確認は連絡ログを必須記録とする

- 日付: 2026-02-10
- 状態: superseded
- 文脈: 参加可否確認の証跡が残らないと、判定延期時に原因追跡ができない
- 決定: M4判定者参加確認では `templates/M4判定者連絡ログテンプレート.md` を必ず使用し、送信日時・回答状態・エスカレーション要否を記録する
- 代替案: チェックリストの参加可否列のみを更新して運用する
- 影響: 監査性は向上する一方、PMの記録作業が増える
- 次回見直し: ADR-031で置換済み

## ADR-028: PLN-019の完了条件を参加確定ベースに補正する

- 日付: 2026-02-10
- 状態: superseded
- 文脈: 既存の受け入れ条件は「追記済み」で満たせるため、実際の参加確定前に `done` へ遷移できてしまう
- 決定: `PLN-019` は4者の参加可否確定、最終連絡日時・回答日時の記録、`確認中=0` を満たした場合のみ `done` とする
- 代替案: 受け入れ条件を据え置き、運用者判断で状態更新する
- 影響: 状態更新の厳密性は上がる一方、記録未入力時に `doing` が長引く可能性がある
- 次回見直し: ADR-031で置換済み

## ADR-029: 判定者参加確認の一次連絡時刻を固定する

- 日付: 2026-02-10
- 状態: superseded
- 文脈: 一次確認の送信時刻が未定だと、実施責任は明確でも実行が後ろ倒しになりやすい
- 決定: 判定者参加確認の一次連絡は `2026-02-17 09:00（ローカル時刻）` を推奨時刻として固定する
- 代替案: 日付のみ定義し時刻は運用者裁量に任せる
- 影響: 実行タイミングのばらつきは減る一方、業務都合で時刻変更が必要な場合の調整が必要
- 次回見直し: ADR-031で置換済み

## ADR-030: 判定者連絡ログは実施版ファイルを起点に運用する

- 日付: 2026-02-10
- 状態: superseded
- 文脈: テンプレートのみでは運用開始時に転記漏れが起きやすく、PLN-019の進捗確認が遅れる
- 決定: `M4判定者連絡ログ_2026-02.md` を実施版として作成し、参加確認記録はこのファイルを起点に更新する
- 代替案: テンプレートを毎回複製して運用する
- 影響: 初動は速くなる一方、月次で実施版ファイルを更新する運用規律が必要になる
- 次回見直し: ADR-031で置換済み

## ADR-031: M4判定はAIプランナーエージェントとユーザー1名で実施する

- 日付: 2026-02-10
- 状態: accepted
- 文脈: プロジェクトはAI駆動開発を前提としており、判定者の参加確認運用が目的に対して過剰だった
- 決定: M4判定体制を `AIプランナーエージェント（評価支援） + ユーザー（最終判定）` に固定し、参加確認テンプレート・連絡ログ運用を廃止する
- 代替案: 4者参加確認の運用を継続する
- 影響: 判定準備の運用負荷は下がる一方、ユーザー最終判定の入力遅延を直接監視する必要がある
- 次回見直し: M4本判定（2026-02-21）

## ADR-032: M4本判定記録は日付付き実施版ファイルを起点に運用する

- 日付: 2026-02-10
- 状態: accepted
- 文脈: 判定当日にテンプレートから作成すると、記録開始が遅れて根拠転記漏れが発生しやすい
- 決定: `M4本判定会_記録_2026-02-21.md` を実施版として作成し、判定当日はこのファイルを更新する
- 代替案: 判定当日にテンプレートを複製して作成する
- 影響: 判定当日の初動は速くなる一方、判定日ごとのファイル管理が必要になる
- 次回見直し: M4本判定（2026-02-21）

## ADR-033: 実装着手前の一次参照を機能別仕様書に統一する

- 日付: 2026-02-10
- 状態: accepted
- 文脈: 個別仕様（01〜12）のみを参照すると、機能横断の依存関係と必須要件の見落としが発生しやすい
- 決定: 実装着手前の一次参照を `plan/specs/13_機能別開発者実装準備仕様.md` に固定し、詳細確認で個別仕様へ遷移する参照順を採用する
- 代替案: 従来どおり個別仕様を先頭から読む運用を継続する
- 影響: 要件の抜け漏れと解釈差分を抑制できる一方、13番仕様の継続保守が必要になる
- 次回見直し: 開発着手後1週間レビュー（2026-02-28）

## ADR-034: 自動PR作成主体をGitHub App（bot）に固定する

- 日付: 2026-02-10
- 状態: accepted
- 文脈: 人アカウントでPRを自動作成すると、author本人はapproveできず運用が停滞する
- 決定: 自動PR作成の認証方式は GitHub App（installation token）を標準とし、PR author を bot に固定する
- 代替案: 専用botユーザー（PAT）または人アカウント切替で運用する
- 影響: approve主体との分離と監査性が向上する一方、App権限・秘密鍵管理の初期整備が必要
- 次回見直し: M3（運用・安全ガードレール確定）時

## ADR-035: GitHub Appの鍵管理は短命token + 定期ローテーションで運用する

- 日付: 2026-02-10
- 状態: accepted
- 文脈: GitHub App方式を採用しても、鍵保管とローテーションが曖昧だと停止リスクと不正利用リスクが残る
- 決定: `14_GitHub App認証と鍵管理仕様.md` を作成し、最小権限、都度発行token、90日以内ローテーション、失効時封じ込め手順を標準化する
- 代替案: 鍵管理は運用者裁量で都度対応する
- 影響: 監査性と復旧性は向上する一方、鍵管理運用の定期作業が発生する
- 次回見直し: M3（運用・安全ガードレール確定）時

## ADR-036: GitHub App installation tokenでbot author PR作成を確認した

- 日付: 2026-02-10
- 状態: accepted
- 文脈: GitHub App方式を採用しても、実際に bot author でPR作成できる実証がないと運用切替できない
- 決定: installation token を用いたスモークテストを実施し、`run_id=smoke-20260210-232019` のPR作成成功を確認した（PR #4）
- 代替案: 実行検証を行わず、文書方針のみで運用開始する
- 影響: PLN-031/032 の完了根拠を確保できる一方、定期再検証タスクを運用に組み込む必要がある
- 次回見直し: M3（運用・安全ガードレール確定）時

## ADR-037: 13番仕様を親に、15番仕様でイベント契約と判定語彙を固定する

- 日付: 2026-02-10
- 状態: accepted
- 文脈: 13番仕様は機能横断の要約として有効だが、実装直前には入出力イベントと異常系出力の粒度が不足し、機能間で語彙の解釈差分が起こりやすい
- 決定: `plan/specs/13_機能別開発者実装準備仕様.md` を親仕様、`plan/specs/15_機能別イベント契約と判定語彙仕様.md` を契約詳細仕様として運用し、実装前参照を2段構成に固定する
- 代替案: 13番仕様のみを拡張し続ける
- 影響: 実装前レビューの再現性が向上する一方、13/15の整合維持が運用タスクとして増える
- 次回見直し: 開発着手後1週間レビュー（2026-02-28）

## ADR-038: 初回開発着手候補をDEV-001〜003の3件に固定する

- 日付: 2026-02-10
- 状態: accepted
- 文脈: M4はGo判定済みだが、初回着手Issueが未選定のままだと実装開始可能タスクが明示できず停滞する
- 決定: 初回着手候補を `DEV-001`（状態遷移基盤）/`DEV-002`（ポリシー+品質ゲート）/`DEV-003`（成果物完全性+GitHub App PR）の3件に固定し、DoR詳細を `plan/specs/16_初回開発Issue候補とDoR詳細.md` に記録する
- 代替案: 個別仕様を都度読み、候補選定を着手当日に判断する
- 影響: 開発開始前の準備が具体化される一方、候補IDを実Issueへ変換する運用タスクが追加される
- 次回見直し: 初回Issue起票完了時（2026-02-11）

## ADR-039: 初回着手候補3件をIssue #5〜#7として正式起票する

- 日付: 2026-02-10
- 状態: accepted
- 文脈: 候補定義のみでは実行開始タスクとして追跡できず、開始順と期限が運用で曖昧になる
- 決定: `DEV-001〜003` を Issue `#5/#6/#7` として起票し、各Issueコメントで担当（PM）、目標期限（2026-02-12〜14）、開始順（1〜3）を確定した
- 代替案: 起票を後日に延期し、バックログ上の候補管理を継続する
- 影響: 開発開始可能タスクが明示される一方、Issue更新と仕様16の同期運用が必要になる
- 次回見直し: DEV-001着手前レビュー（2026-02-11）

## ADR-040: DEV-001（Issue #5）の最終DoRレビューを充足で確定する

- 日付: 2026-02-10
- 状態: accepted
- 文脈: 初回着手順の先頭Issueは、着手前にDoR不足がないことを明示しないと実装開始判断が曖昧になる
- 決定: Issue #5 のDoR（目的/受け入れ条件/影響範囲/テスト観点/関連リスク）を最終レビューし、充足判定（不足追記なし）で確定した
- 代替案: DoR再確認を省略して実装着手する
- 影響: 初回着手の再現性は上がる一方、後続Issue（#6/#7）にも同等レビューを継続する運用が必要になる
- 次回見直し: DEV-002着手前レビュー（2026-02-11）

## ADR-041: DEV-002（Issue #6）の最終DoRレビューを充足で確定する

- 日付: 2026-02-10
- 状態: accepted
- 文脈: 2件目着手IssueでもDoRの最終確認を省略すると、例外運用と品質ゲートの統制に穴が出る可能性がある
- 決定: Issue #6 のDoR（目的/受け入れ条件/影響範囲/テスト観点/関連リスク）を最終レビューし、充足判定（不足追記なし）で確定した
- 代替案: DEV-001での確認結果を流用し、個別レビューを省略する
- 影響: 2件目着手の品質再現性が向上する一方、3件目Issue（#7）にも同様レビューを継続する必要がある
- 次回見直し: DEV-003着手前レビュー（2026-02-11）

## ADR-042: DEV-003（Issue #7）の最終DoRレビューを充足で確定する

- 日付: 2026-02-10
- 状態: accepted
- 文脈: 成果物出口（完全性検証+GitHub App PR）のDoRが未確認だと、初回運用で監査追跡が崩れる可能性がある
- 決定: Issue #7 のDoR（目的/受け入れ条件/影響範囲/テスト観点/関連リスク）を最終レビューし、充足判定（不足追記なし）で確定した
- 代替案: #5/#6のみレビューし、#7は着手時に随時補正する
- 影響: 初回3件の着手前DoRが揃い、開始順に沿った運用へ移行しやすくなる一方、着手順の共有運用を維持する必要がある
- 次回見直し: 初回3件着手順の共有完了時（2026-02-11）

## ADR-043: Go後の開発フェーズ移行を最終承認し、着手順を固定する

- 日付: 2026-02-10
- 状態: accepted
- 文脈: Go判定とDoR充足が完了していても、最終承認の記録がないと実装着手順の監査証跡が不十分になる
- 決定: 開発フェーズ移行を最終承認し、初回着手順を Issue `#5 -> #6 -> #7` に固定した。承認結果は `plan/M4本判定会_記録_2026-02-21.md` の次アクション完了として同期記録する
- 代替案: M4記録の次アクション欄を未更新のまま、Issueコメント運用のみで着手を開始する
- 影響: 判定から着手開始までの意思決定追跡が一貫する一方、着手順変更時はADR更新を必須運用にする必要がある
- 次回見直し: 初回着手3件の進捗レビュー時（2026-02-12）

## ADR-044: 初回開発着手は13/15/16/17の4文書を一次参照として固定する

- 日付: 2026-02-10
- 状態: accepted
- 文脈: Go後にIssue単位で実装を開始する段階では、13/15/16だけだと実務の引き渡し順序と更新責任が分散しやすい
- 決定: `17_初回開発着手ハンドオーバー仕様.md` を追加し、初回着手時の一次参照を `13 -> 15 -> 16 -> 17` に固定する
- 代替案: 16番仕様までを一次参照とし、着手順や更新責任はIssueコメントで都度補足する
- 影響: 初回3Issueの着手再現性は向上する一方、参照順変更時のADR同期運用が必要になる
- 次回見直し: 初回着手3件の進捗レビュー時（2026-02-12）

## ADR-045: DEV-001の状態遷移と復帰契約を18番仕様で固定する

- 日付: 2026-02-10
- 状態: accepted
- 文脈: Issue #5 のDoRは充足済みだが、`run_id` 再採番条件と `blocked_reason` の運用語彙が散在したままだと、着手時に状態遷移解釈が再分岐する
- 決定: `18_DEV-001状態遷移と復帰契約仕様.md` を追加し、許可遷移（`queued/running/blocked/completed`）、復帰入力項目、DEV-001で使用する `blocked_reason`（`spec_invalid` / `lock_mismatch` / `resource_exceeded` / `cleanup_failed` / `retry_condition_unmet`）を固定する
- 代替案: `01` / `15` / `17` の既存記述のみを参照し、DEV-001専用の契約詳細を作成しない
- 影響: Issue #5 着手時の判断再現性は向上する一方、語彙追加時は `15` と `18` の同時更新を必須にする運用が必要になる
- 次回見直し: Issue #5 進捗レビュー時（2026-02-11）

## ADR-046: Issue #5の指摘を受け、状態遷移と記録形式を仕様横断で統一する

- 日付: 2026-02-10
- 状態: accepted
- 文脈: `18` の遷移が `blocked -> queued` 表現となっており、`01` / Issue #5 の `blocked -> retry -> running` と不一致だった。あわせて `15` で命名規約/時刻形式/Run Header形式が未決扱いのままで、DEV-001の「確定済み」表現と矛盾していた
- 決定: 状態遷移は `blocked -> retry -> running` に統一し、`retry` を実行状態語彙に含める。`blocked_reason` は `snake_case`（接頭辞なし）、`timestamp` は UTC ISO8601、Run Header は JSON 固定とする。give-up上限は `01` の `FR-105`（初期値5）を Issue #5 レビュー時の正本参照に固定する
- 代替案: `18` 側のみの文言補正で対応し、上位仕様の未決事項は維持する
- 影響: 仕様間の解釈分岐を解消できる一方、フォーマット変更時は `01/15/18` の同時更新が必須になる
- 次回見直し: Issue #5 進捗レビュー時（2026-02-11）

## ADR-047: 再指摘を受け、誤読を生む遷移表記を除去し参照導線をIssueへ固定する

- 日付: 2026-02-10
- 状態: accepted
- 文脈: `18` の「不許可遷移」に `blocked -> queued` が残っていたため、許可遷移（`blocked -> retry -> running`）との並存と誤読された。さらに `15` の節名が「未決事項」だったため、固定済み項目でも未決に見える問題が残った
- 決定: `18` から `blocked -> queued` 表記を除去し、復帰経路を `blocked -> retry -> running` のみと明記する。`15` は節名を「固定値（v0.2確定）」に変更する。Issue #5 コメントに `01` の `FR-105`（初期値5）を正本参照として明示する
- 代替案: 既存文書を維持し、レビュー時に口頭補足のみで解釈を合わせる
- 影響: 文書単体での判定一貫性が向上する一方、Issue本文/コメントの参照同期を継続運用する必要がある
- 次回見直し: Issue #5 再レビュー時（2026-02-11）

## ADR-059: Issue #5レビューで判明した仕様不整合をP0補正対象として扱う（旧ID: ADR-047）

- 日付: 2026-02-12
- 状態: accepted
- 文脈: Issue #5（DEV-001）のレビューで、`blocked` 復帰の表現（4状態契約と `retry` ラベル運用）および `blocked_reason` 関連の未決事項記述に仕様間不整合が確認された
- 決定: DEV-001は「企画継続（実装未着手）」を維持しつつ、不整合の補正をP0で先行する。補正対象は `01`/`15`/`18` と Issue #5 の参照整合とし、台帳上は `PLN-044`/`PLN-045` と `R-020` で追跡する
- 代替案: 既存のDoR充足判定を維持し、仕様差分を実装時に吸収する
- 影響: 着手前の解釈差分を抑止できる一方、同日中の文書同期作業が追加で必要になる
- 次回見直し: DEV-001進捗レビュー時（2026-02-12）

## ADR-048: Issue #6レビューで判明した判定境界不整合をP0補正対象として扱う

- 日付: 2026-02-12
- 状態: accepted
- 文脈: Issue #6（DEV-002）の再レビューで、`deny` と `blocked` の境界、`skip` 系違反時の例外可否、監査項目（承認者/失効日）の出力契約に仕様間の解釈差分が確認された
- 決定: DEV-002は「企画継続（実装未着手）」を維持しつつ、判定境界と監査出力の補正をP0で先行する。補正対象は `05`/`06`/`11`/`15` と Issue #6 の受け入れ条件整合とし、台帳上は `PLN-046`/`PLN-047`/`PLN-048` と `R-021` で追跡する
- 代替案: 既存DoR充足判定を維持し、仕様差分は実装時に吸収する
- 影響: fail-closed運用の再現性と監査追跡性は向上する一方、Issue #6 着手前に仕様同期の追加作業が必要になる
- 次回見直し: DEV-002着手前レビュー時（2026-02-13）

## ADR-049: GitHub書き込み操作は全エージェントでGitHub App bot主体に統一する

- 日付: 2026-02-12
- 状態: accepted
- 文脈: 並列セッション運用で人アカウントとbotアカウントが混在すると、PR authorの一貫性と監査追跡（`app_slug`）が崩れ、approve衝突の再発リスクが高まる
- 決定: 全エージェントのGitHub書き込み操作（PR作成/更新、Issueコメント、PR close）は `multi-agent-orchestrator-bot` を標準主体とし、`installation token` を都度発行して `GH_TOKEN` 指定で実行する
- 代替案: エージェントごとに認証主体を許可し、必要時のみbotへ切替える
- 影響: author一貫性と監査性は向上する一方、token発行失敗時の復旧手順運用が必須になる
- 次回見直し: bot運用レビュー時（2026-02-19）

## ADR-050: PR #12マージ完了後はmain同期と作業ブランチ整理を同時実施する

- 日付: 2026-02-13
- 状態: accepted
- 文脈: PR #12 のマージ後にローカル `main` と作業ブランチが残ると、次セッション開始時に参照先の誤認や不要ブランチ滞留が発生しやすい
- 決定: PR #12 マージ完了を起点に、`main` を `origin/main` へ同期し、`codex/planning-update-001` をローカル/リモート双方で削除する運用を実施した
- 代替案: ブランチ整理を次回着手時まで延期し、都度手動で判別する
- 影響: 次回セッションの開始コストと誤操作リスクを低減できる一方、マージ直後の整理作業を標準手順として維持する必要がある
- 次回見直し: 次回マージ完了時（2026-02-20）

## ADR-051: PR #13マージ完了後も同一後処理手順を継続適用する

- 日付: 2026-02-13
- 状態: accepted
- 文脈: PR #13（ADR-050追記）がマージされたため、同期とブランチ整理の再実施結果を意思決定ログへ残し、後処理運用の継続性を明示する必要がある
- 決定: PR #13 マージ確認後、`main` を `origin/main` に同期し、`codex/issue-12` をリモート/ローカル双方で削除した。後処理は「マージ確認→main同期→作業ブランチ削除→記録更新」を標準とする
- 代替案: PR #13 マージ後の後処理は記録せず、都度運用者判断とする
- 影響: 後処理手順の再現性と監査追跡性が向上する一方、各マージ完了時に短い記録更新作業を継続する必要がある
- 次回見直し: 次回マージ完了時（2026-02-20）

## ADR-052: 企画継続前提でM4後のマクロ計画（M5〜M8）を採用する

- 日付: 2026-02-13
- 状態: accepted
- 文脈: `M4: done` の履歴と、現行 `AGENTS.md` の「企画フェーズ継続」運用が並存しており、着手判断の基準がセッションごとにぶれるリスクがある
- 決定: 2026-02-13時点の運用基準として、マクロ計画を `M5〜M8`（P0不整合解消 -> 運用前提固定 -> 初回3Issue出口条件固定 -> 企画最終判定）で再整理する。企画フェーズ継続中は、実装着手の判定条件をこの4マイルストーンで管理する
- 代替案: `ADR-043` の履歴を根拠に直ちに実装着手へ移行し、残論点を実装中に吸収する
- 影響: 判断ゲートの再現性と監査追跡性は向上する一方、`PLN-045〜048` の収束完了までは企画タスクの優先運用が必要になる
- 次回見直し: M5レビュー時（2026-02-16）

## ADR-053: DEV-002の判定境界・例外可否・監査出力契約を仕様横断で固定する

- 日付: 2026-02-13
- 状態: accepted
- 文脈: `R-021` の主要因である `deny/blocked` 境界、`skip`系違反の例外可否、承認者/失効日の出力先が仕様間で分散しており、Issue単位の判定再現性が不足していた
- 決定: `05`/`06`/`11`/`15` に共通の語彙マッピングと監査出力先（Issueコメント/構造化ログ）を追記し、`PLN-046`/`PLN-047`/`PLN-048` を `done` とする
- 代替案: 既存の個別文言を維持し、レビュー都度の解釈合わせで運用する
- 影響: fail-closed運用と監査追跡の再現性は向上する一方、語彙変更時に4文書の同時更新を維持する運用負荷が発生する
- 次回見直し: M8再Go/No-Go判定時（2026-02-21）

## ADR-054: M5判定表とM8入力テンプレートを標準化し、再判定運用を固定する

- 日付: 2026-02-13
- 状態: accepted
- 文脈: M5完了判定とM8再Go/No-Go判定の入力項目が分散したままだと、同一条件でも判定結果が変わるリスクが残る
- 決定: `plan/M5完了判定チェック表.md` をM5判定の正本、`plan/templates/M8再Go-No-Go入力テンプレート.md` をM8入力の正本として採用する
- 代替案: 既存のマイルストーン文面と都度メモのみで判定する
- 影響: 判定記録の欠落を防止できる一方、判定時にテンプレートの記入更新を必須作業として維持する必要がある
- 次回見直し: M8再Go/No-Go判定時（2026-02-21）

## ADR-055: M8再Go/No-Go判定を実施し、次フェーズ移行条件を確定する

- 日付: 2026-02-13
- 状態: accepted
- 文脈: `M8` の状態は `ready` で、M5〜M7完了後の最終判定実体（P0リスク許容判断、実装開始日、担当、監査手順）の記録が未作成だった
- 決定: `plan/M8再Go-No-Go判定_2026-02-13.md` を作成し、M5〜M7完了確認、P0リスク許容判断、次フェーズ移行条件（実装開始日 2026-02-16、担当、初回着手順）、監査手順を固定した。総合判定は `Go` とし、`plan/マイルストーン.md` の `M8` 状態を `done` へ更新する
- 代替案: M8判定を `Conditional Go` のまま据え置き、実装開始日のみ後日確定する
- 影響: フェーズ移行判断の監査追跡性が向上し、着手判断の分岐リスク（`R-023`）を低減できる一方、監査手順（日次確認・停止条件）の運用継続が前提になる
- 次回見直し: 初回着手Issueレビュー時（2026-02-16）

## ADR-056: 個人xマルチエージェント運用プロファイルを標準運用として採用する

- 日付: 2026-02-13
- 状態: accepted
- 文脈: 企画成果物は揃ったが、個人運用でのWIP制御・日次監査・セッション入出力が分散記述のままだと、判断遅延と台帳反映漏れが再発するリスクがある
- 決定: `19_個人xマルチエージェント運用最適化仕様.md` を追加し、`running<=2`、24時間超 `blocked` 時の新規着手停止、3モード運用（Focus/Parallel/Recovery）、日次レビュー運用を標準化する。あわせて `AGENTS.md`、`13_機能別開発者実装準備仕様.md`、`企画書`、`エージェント` に反映する
- 代替案: 現行文書のまま都度判断で運用し、個人運用ルールを明文化しない
- 影響: 個人運用の再現性と監査効率は向上する一方、日次レビュー記録の継続運用が新たな必須作業となる
- 次回見直し: 初回週次レビュー時（2026-02-20）

## ADR-057: GitHub前提のCommit->PR->Merge->Done運用を標準化する

- 日付: 2026-02-13
- 状態: accepted
- 文脈: 個人x複数エージェント運用で、作業は並列化できる一方、統合手順（PR更新条件、レビュー順、Done判定）が曖昧だと main 反映の安全性と速度が両立しない
- 決定: `plan/specs/20_GitHub前提コミットPRマージ完了運用仕様.md` を正本として採用し、`1 Issue = 1 branch = 1 PR`、CI赤PRのレビュー保留、二段レビュー、直列統合、Done判定を標準化する
- 代替案: 既存の個別文書と都度判断で運用し、Commit/PR/Merge手順を固定しない
- 影響: 統合時の再現性と監査性は向上する一方、PRごとの提出フォーマット遵守（Task Brief/PRチェックリスト）が運用必須になる
- 次回見直し: 初回実装週の運用レビュー時（2026-02-20）

## ADR-058: 起動時コンテキストファイルの分類・優先・変更管理を標準化する

- 日付: 2026-02-13
- 状態: accepted
- 文脈: 複数エージェント運用で `AGENTS.md` とツール別指示ファイルの用途が混在すると、前提説明の重複と指示ドリフトが発生しやすい
- 決定: `plan/specs/21_起動時コンテキストファイル運用仕様.md` を正本として採用し、always-onとon-demandの分離、近接優先/override優先、秘密情報非記載、変更時の台帳反映を標準運用にする
- 代替案: 単一ファイルへ運用ルールを集約し、用途分離を行わない
- 影響: セッション開始時のコンテキスト整合性は向上する一方、ファイル分割と更新同期の運用手間が増える
- 次回見直し: 起動時ルール更新レビュー時（2026-02-20）

## ADR-060: GitHub保護設定の実環境反映は次フェーズ初日に監査付きで実施する

- 日付: 2026-02-13
- 状態: accepted
- 文脈: `specs/20` で標準フローは定義済みだが、実際のリポジトリ設定（Branch protection / required checks）への反映は企画フェーズの作業境界外であり、反映漏れがあると `R-026` が残存する
- 決定: 企画フェーズでは設定値の仕様化と監査テンプレート整備までとし、実環境への設定反映・監査実施は次フェーズ初日の優先タスクとして実施する
- 代替案: 企画フェーズ中に即時で設定変更を行い、記録は後追いで整備する
- 影響: フェーズ境界の一貫性は保てる一方、次フェーズ開始時に監査タスク（PLN-064）を最優先で実行する運用が必要になる
- 次回見直し: 次フェーズ開始レビュー時（2026-02-16）

## ADR-061: GitHubブランチ保護監査結果を受け、保護設定リスクを緩和状態へ更新する

- 日付: 2026-02-13
- 状態: accepted
- 文脈: `ADR-060` で次フェーズ初日の監査実施を決定しており、ユーザーからGitHub設定完了報告があったため、実施記録と台帳反映を同日中に確定する必要があった
- 決定: `plan/GitHubブランチ保護監査_2026-02-13.md` を実施版として作成し、`PLN-064` を `done`、`R-026` を `mitigated` へ更新する
- 代替案: 監査記録をテンプレート上でのみ保持し、台帳反映を次回日次レビューまで延期する
- 影響: ブランチ保護設定に関する監査証跡の即時性が向上し、未検証PR流入リスクの残存説明が容易になる一方、今後も設定変更時に同日反映を継続する運用負荷が発生する
- 次回見直し: 次回定期監査時（2026-02-20）

## ADR-062: GitHub保護設定の定期監査周期を週次で固定する

- 日付: 2026-02-13
- 状態: accepted
- 文脈: `ADR-061` で監査実施は完了したが、定期監査の周期が未固定だと `R-026` の再発検知が運用者依存になる
- 決定: `specs/20` に定期監査ルールを追記し、監査周期を週1回（毎週金曜）とする。設定変更時は同日中の臨時監査を必須化する
- 代替案: 監査周期を固定せず、設定変更時のみ監査する
- 影響: 監査運用の再現性は向上する一方、週次の記録更新作業が定常タスクになる
- 次回見直し: 初回週次監査実施後（2026-02-20）

## ADRテンプレート

- ID: ADR-XXX
- 日付: YYYY-MM-DD
- 状態: proposed / accepted / rejected / superseded
- 文脈:
- 決定:
- 代替案:
- 影響:
- 次回見直し:
